<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
<link href="/themes/default/styles/manage.css" type="text/css" rel="stylesheet"/>
<link type="text/css" rel="Stylesheet" href="/themes/default/scripts/jquery-easyui-1.3/themes/default/easyui.css" />
<link type="text/css" rel="Stylesheet" href="/themes/default/scripts/jquery-easyui-1.3/themes/icon.css" />
<link type="text/css" rel="Stylesheet" href="/themes/default/styles/pagestyle.css" />
<script type="text/javascript" src="/themes/default/scripts/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="/themes/default/scripts/jquery-easyui-1.3/jquery.easyui.min.js"></script> 
<script type="text/javascript" src="/themes/default/scripts/jquery-easyui-1.2/easyui-lang-zh_CN.js"></script> 
<script src="/js/jsontimeconvertor.js" type="text/javascript"></script>
<script type="text/javascript" src="/js/jquery.form.js"></script>
<script type="text/javascript" src="/js/init.js"></script>
<script type="text/javascript" src="/js/dialog.js"></script>
 
<script language="javascript" type="text/javascript">
    $(document).ready(function () {
        $(".c_table tr:even").css("background", "#EEEEFF");
        $(".c_table tr").mouseover(function () { $(this).css("background", "#E7F5FE") });
        $(".c_table tr").mouseout(function () {
            $(".c_table tr:even").css("background", "#EEEEFF");
            $(".c_table tr:odd").css("background", "#FFFFFF");
            /*fjdsalfjasdkl*/
        });
    })
</script>

    <script type="text/javascript">
        (function ($) {
            $.fn.extend({
                MultDropList: function (options) {
                    var op = $.extend({ wraperClass: "wraper", width: "150px", height: "200px", data: "", selected: "" }, options);
                    return this.each(function () {
                        var $this = $(this); //指向TextBox
                        var $hf = $(this).next(); //指向隐藏控件存
                        var conSelector = "#" + $this.attr("id") + ",#" + $hf.attr("id");
                        var $wraper = $(conSelector).wrapAll("<div><div></div></div>").parent().parent().addClass(op.wraperClass);

                        var $list = $('<div class="otherChanneList"></div>').appendTo($wraper);
                        $list.css({ "width": op.width, "height": op.height });
                        //控制弹出页面的显示与隐藏
                        $this.click(function (e) {
                            $(".otherChanneList").hide();
                            $list.toggle();
                            e.stopPropagation();
                        });

                        $(document).click(function () {
                            $list.hide();
                        });

                        $list.filter("*").click(function (e) {
                            e.stopPropagation();
                        });
                        //加载默认数据
                        $list.append('<ul><li><input type="checkbox" class="selectAll" value="" /><span>全部</span></li></ul>');
                        var $ul = $list.find("ul");

                        //加载json数据
                        var listArr = op.data.split("|");
                        var jsonData;
                        for (var i = 0; i < listArr.length; i++) {
                            jsonData = eval("(" + listArr[i] + ")");
                            $ul.append('<li><input type="checkbox" value="' + jsonData.k + '" /><span>' + jsonData.v + '</span></li>');
                        }

                        //加载勾选项
                        var seledArr;
                        if (op.selected.length > 0) {
                            seledArr = selected.split(",");
                        }
                        else {
                            seledArr = $hf.val().split(",");
                        }

                        $.each(seledArr, function (index) {
                            $("li input[value='" + seledArr[index] + "']", $ul).attr("checked", "checked");

                            var vArr = new Array();
                            $("input[class!='selectAll']:checked", $ul).each(function (index) {
                                vArr[index] = $(this).next().text();
                            });
                            $this.val(vArr.join(","));
                        });
                        //全部选择或全不选
                        $("li:first input", $ul).click(function () {
                            if ($(this).attr("checked")) {
                                $("li input", $ul).attr("checked", "checked");
                            }
                            else {
                                $("li input", $ul).removeAttr("checked");
                            }
                        });
                        //点击其它复选框时，更新隐藏控件值,文本框的值
                        $("input", $ul).click(function () {
                            var kArr = new Array();
                            var vArr = new Array();
                            $("input[class!='selectAll']:checked", $ul).each(function (index) {
                                kArr[index] = $(this).val();
                                vArr[index] = $(this).next().text();
                            });
                            $hf.val(kArr.join(","));
                            $this.val(vArr.join(","));
                        });
                    });
                },

                PrefixEdit: function (prefixs) {
                    var op = $.extend({ wraperClass: "PrefixEdit", width: "323px", height: "250px", data: "" }, prefixs);
                    return this.each(function () {
                        var $this = $(this); //指向TextBox
                        var $hf = $(this).next(); //指向隐藏控件存
                        var conSelector = "#" + $this.attr("id") + ",#" + $hf.attr("id");
                        var $wraper = $(conSelector).wrapAll("<div><div></div></div>").parent().parent().addClass(op.wraperClass);

                        var $list = $('<div class="prefixList"></div>').appendTo($wraper);
                        $list.css({ "width": op.width, "height": op.height });
                        //控制弹出页面的显示与隐藏
                        $this.click(function (e) {
                            $(".prefixList").hide();
                            $list.toggle();
                            e.stopPropagation();
                        });

                        $(document).click(function () {
                            $list.hide();
                        });

                        $list.filter("*").click(function (e) {
                            e.stopPropagation();
                        });
                        //加载默认数据
                        $list.append('<ul></ul>');
                        var $ul = $list.find("ul");

                        //加载json数据
                        var listArr = op.data.split("|");
                        var jsonData;
                        for (var i = 0; i < listArr.length; i++) {
                            jsonData = eval("(" + listArr[i] + ")");
                            $ul.append('<li id="' + jsonData.k + '"><span>' + jsonData.v + '</span><span style="float: right;"><img src="../themes/default/scripts/jquery-easyui-1.3/themes/icons/pencil.png" width="12px" height="12px" title="修改"/> <img src="../themes/default/scripts/jquery-easyui-1.3/themes/icons/cancel.png" width="12px" height="12px" title="删除"/></span></li>');
                        }
                        var addSpan = $('<li style="cursor:pointer;" title="新增"><span style="float: left; padding-left: 60px"><img src="../themes/default/scripts/jquery-easyui-1.3/themes/icons/edit_add.png"/></span></li>');
                        addSpan.click(function () {
                            $(".prefixList").hide();
                            //重置
                            $("#divbody").find("input:text").val("");
                            ShowEditItemDialog('', 'divbody', 525, 200, function (j_dialog) { InsertNewsTitlePrefix(j_dialog); });
                            return false;
                        });
                        $ul.append(addSpan);

                        $("li span img[title='修改']", $ul).click(function () {
                            alert($(this).parent().parent().attr("id") + "修改");
                        });

                        $("li span img[title='删除']", $ul).click(function () {
                            alert($(this).parent().parent().attr("id") + "删除");
                        });
                    });
                }
            });
        })(jQuery);

        $(document).ready(function () {
            //$("#txtTest").MultDropList({ data: $("#hfddlList").val() });
            $("#txtTest").PrefixEdit({ data: $("#Hidden1").val() });
        });

        //添加方法
        function InsertNewsTitlePrefix(j_dialog) {
            if (ValidateForm() == false) return;
            var prefix = $("#txtPrefix").val();
            var j_waitDialog = ShowWaitMessageDialog();
            $.ajax({
                url: '/AjaxNewsTitlePrefix/InsertNewsTitlePrefix.cspx',
                data: { 'prefix': prefix },
                type: 'POST',
                complete: function () { HideWaitMessageDialog(j_waitDialog); },
                success: function () {
                    $.messager.alert(g_MsgBoxTitle, "操作成功。", "info", function () {
                        j_dialog.dialog('close');
                        $('#pgnewstitleprefix').datagrid('reload');
                    });
                }
            })
        }

        //数据显示的方法
        function ShowNewsTitlePrefix() {
            var dom = this;
            var Id = $(this).attr("rowId");
            $.ajax({
                url: '/AjaxNewsTitlePrefix/GetNewsTitlePrefixById.cspx?Id=' + Id,
                dataType: "json",
                success: function (json) {

                    $("#txtPrefix").val(json.Prefix);
                    // 显示编辑对话框
                    ShowEditItemDialog(Id, 'divbody', 525, 200, function (j_dialog) {
                        // 验证输入
                        if (ValidateForm()) {
                            var j_waitDialog = ShowWaitMessageDialog();
                            var prefix = $("#txtPrefix").val();
                            $.ajax({
                                type: "POST",
                                url: "/AjaxNewsTitlePrefix/UpdateNewsTitlePrefix.cspx",
                                data: { 'Id': Id, 'prefix': prefix
                                },
                                complete: function () { HideWaitMessageDialog(j_waitDialog); },
                                success: function (responseText) {
                                    $.messager.alert(g_MsgBoxTitle, "操作成功。", "info", function () {
                                        j_dialog.hide().dialog('close');
                                        $('#pgnewstitleprefix').datagrid('reload');
                                    });
                                }
                            });
                        }
                    });
                }
            });
        }

        //验证方法
        function ValidateForm() {
            if (ValidateControl("#txtPrefix", "标题前标签名称 不能为空。") == false) return false;
            return true;
        }
        
    </script>

    <style type="text/css">
        .PrefixEdit
        {
            font-size:12px;
        }
        
        .prefixList ul,li{list-style:none;margin:0;padding:0;}
        
        .prefixList
        {
            width: 200px;
            height: 200px;
            overflow: auto;
            position: absolute;
            border: 1px solid #617775;
            display: none;
            background: none repeat scroll 0 0 #f2f2f2;
            float: left;
            z-index: 1000000;
        }
        .prefixList ul li
        {
            list-style:none;
            padding: 3px;
            padding-bottom: 2px;
            border: 1px dotted black;
            margin: 5px 5px 0px 5px;
            width: 135px;
            float: left;
            
        }
        .prefixList ul li span
        {
            cursor:pointer;
        }
        .prefixList ul li img
        {
            cursor:pointer;
        }
        
        
        
        .wraper
        {
            font-size:12px;
        }
        
        .otherChanneList
        {
            width: 200px;
            height: 200px;
            overflow: auto;
            position: absolute;
            border: 1px solid #617775;
            display: none;
            background: none repeat scroll 0 0 #F0F6E4;
            float: left;
            z-index: 1000000;
        }
        .otherChanneList ul li
        {
            padding-left: 0px;
            padding-top: 2px;
            padding-bottom: 2px;
            border-top: 1px solid black;
        }

        ul
        {
            list-style:none outside none;
            padding-left:3px;
        }
    </style>
</head>
<body id="bb">
 <input type="hidden" id="Hidden1" value='{k:1,v:"基金"}|{k:2,v:"热点"}|{k:3,v:"机构"}|{k:4,v:"利好"}'  />
        <div class="testContainer">
            <br />
            <br />
            <br />
            <br />
            
            <div style="margin-left: 300px; height: 30px;">
                <input type="hidden" id="hfddlList" value='{k:1,v:"南京"}|{k:2,v:"上海"}|{k:3,v:"扬州"}|{k:4,v:"苏州"}|{k:5,v:"无锡"}|{k:6,v:"常州"}|{k:7,v:"盐城"}|{k:8,v:"徐州"}|{k:9,v:"泰州"}|{k:10,v:"淮安"}'  />
                <input type="text" id="txtTest" />
                <input type="hidden" id="hfTest" value="3,5" />
            </div>
        </div>

        <div id="divbody" title="标题前标签" style="padding: 8px; display: none">
        <table cellpadding="4" border="0px">
            <tr>
                <td style="width: 100px">
                    标题前标签名称:
                </td>
                <td>
                    <input name="Prefix" type="text" maxlength="50" id="txtPrefix" class="w300" />
                </td>
            </tr>
        </table>
    </div>

</body>
<script>
    alert(document.getElementById("bb").innerHTML);
</script>
</html>
